// Backbone.ModelBinding v0.3.10
//
// Copyright (C)2011 Derick Bailey, Muted Solutions, LLC
// Distributed Under MIT Liscene
//
// Documentation and Full Licence Availabe at:
// http://github.com/derickbailey/backbone.modelbinding
Backbone.ModelBinding=function(f){return{version:"0.3.10",bind:function(b,e){f.ModelBinding.Configuration.configureBindingAttributes(e);var c=b.model,d=f.ModelBinding.Conventions,a;for(a in d)if(d.hasOwnProperty(a)){var g=d[a];g.handler.bind(g.selector,b,c)}f.ModelBinding.Configuration.restoreBindingAttrConfig()},unbind:function(b){var e=b.model,c=f.ModelBinding.Conventions,d;for(d in c)if(c.hasOwnProperty(d)){var a=c[d],g=a.handler,a=a.selector;g.unbind&&g.unbind(a,b,e)}}}}(Backbone);
Backbone.ModelBinding.Configuration=function(f){var b={text:"id",textarea:"id",password:"id",radio:"name",checkbox:"id",select:"id"};return{configureBindingAttributes:function(e){e&&(this.storeBindingAttrConfig(),e.all&&(this.configureAllBindingAttributes(e.all),delete e.all),f.extend(b,e))},configureAllBindingAttributes:function(e){this.storeBindingAttrConfig();b.text=e;b.textarea=e;b.password=e;b.radio=e;b.checkbox=e;b.select=e},storeBindingAttrConfig:function(){this._config=f.clone(b)},restoreBindingAttrConfig:function(){if(this._config)b=
this._config,delete this._config},getBindingAttr:function(e){return b[e]},getBindingValue:function(b,c){var d=this.getBindingAttr(c);return b.attr(d)}}}(_);
Backbone.ModelBinding.StandardBinding=function(f){var b={_getElementType:function(b){var c=b[0].tagName.toLowerCase();if(c=="input"&&(c=b.attr("type"),c==void 0||c==""))c="text";return c},_modelChange:function(b,c){this.element.val(c)}};b.unbind=function(e,c,d){c.$(e).each(function(){var a=c.$(this),a=f.ModelBinding.Configuration.getBindingValue(a,b._getElementType(a));d.unbind("change:"+a,b._modelChange)})};b.bind=function(e,c,d){c.$(e).each(function(){var a=c.$(this),g=f.ModelBinding.Configuration.getBindingValue(a,
b._getElementType(a));d.bind("change:"+g,b._modelChange,{element:a});a.bind("change",function(a){var b={};b[g]=c.$(a.target).val();d.set(b)});var h=d.get(g);typeof h!=="undefined"&&h!==null&&a.val(h)})};return b}(Backbone);
Backbone.ModelBinding.SelectBoxBinding=function(f){var b={_modelChange:function(b,c){this.element.val(c)}};b.unbind=function(e,c,d){c.$(e).each(function(){var a=c.$(this),a=f.ModelBinding.Configuration.getBindingValue(a,"select");d.unbind("change:"+a,b._modelChange)})};b.bind=function(e,c,d){c.$(e).each(function(){var a=c.$(this),g=f.ModelBinding.Configuration.getBindingValue(a,"select");d.bind("change:"+g,b._modelChange,{element:a});a.bind("change",function(a){var b={},a=c.$(a.target);b[g]=a.val();
b[g+"_text"]=a.find(":selected").text();d.set(b)});var h=d.get(g);typeof h!=="undefined"&&h!==null&&(a.val(h),a.val()!=h&&(h={},h[g]=a.val(),d.set(h)))})};return b}(Backbone);
Backbone.ModelBinding.RadioGroupBinding=function(f){var b={_modelChange:function(b,c){this.view.$("input[type=radio]["+this.bindingAttr+"="+this.group_name+"][value="+c+"]").attr("checked","checked")}};b.unbind=function(e,c,d){var a=[];c.$(e).each(function(){var g=c.$(this),g=f.ModelBinding.Configuration.getBindingValue(g,"radio");a[g]||(a[g]=!0,f.ModelBinding.Configuration.getBindingAttr("radio"),d.unbind("change:"+g,b._modelChange))})};b.bind=function(e,c,d){var a=[];c.$(e).each(function(){var g=
c.$(this),h=f.ModelBinding.Configuration.getBindingValue(g,"radio");if(!a[h]){a[h]=!0;g=f.ModelBinding.Configuration.getBindingAttr("radio");d.bind("change:"+h,b._modelChange,{bindingAttr:g,group_name:h,view:c});c.$("input[type=radio]["+g+"="+h+"]").bind("change",function(a){a=c.$(a.currentTarget);if(a.is(":checked")){var b={};b[h]=a.val();d.set(b)}});var e=d.get(h);typeof e!=="undefined"&&e!==null&&c.$("input[type=radio]["+g+"="+h+"][value="+e+"]").attr("checked","checked")}})};return b}(Backbone);
Backbone.ModelBinding.CheckboxBinding=function(f){var b={_modelChange:function(b,c){c?this.element.attr("checked","checked"):this.element.removeAttr("checked")}};b.unbind=function(e,c,d){c.$(e).each(function(){var a=c.$(this),a=f.ModelBinding.Configuration.getBindingValue(a,"checkbox");d.unbind("change:"+a,b._modelChange)})};b.bind=function(e,c,d){c.$(e).each(function(){var a=c.$(this),g=f.ModelBinding.Configuration.getBindingValue(a,"checkbox");d.bind("change:"+g,b._modelChange,{element:a});a.bind("change",
function(a){var b={},a=c.$(a.target).is(":checked")?!0:!1;b[g]=a;d.set(b)});if(d.attributes.hasOwnProperty(g)){var h=d.get(g);typeof h!=="undefined"&&h!==null&&h!=!1?a.attr("checked","checked"):a.removeAttr("checked")}})};return b}(Backbone);
Backbone.ModelBinding.DataBindBinding=function(f,b,e){var c={},d={"default":""};f.ModelBinding.Configuration.dataBindSubst=function(a){this.storeDataBindSubstConfig();b.extend(d,a)};f.ModelBinding.Configuration.storeDataBindSubstConfig=function(){f.ModelBinding.Configuration._dataBindSubstConfig=b.clone(d)};f.ModelBinding.Configuration.restoreDataBindSubstConfig=function(){if(f.ModelBinding.Configuration._dataBindSubstConfig)d=f.ModelBinding.Configuration._dataBindSubstConfig,delete f.ModelBinding.Configuration._dataBindSubstConfig};
f.ModelBinding.Configuration.getDataBindSubst=function(a,b){var c=b;b===void 0&&(c=d.hasOwnProperty(a)?d[a]:d["default"]);return c};c._modelChange=function(a,b){c._setOnElement(this.element,this.elementAttr,b)};c._setOnElement=function(a,b,c){c=f.ModelBinding.Configuration.getDataBindSubst(b,c);switch(b){case "html":a.html(c);break;case "text":a.text(c);break;case "enabled":a.attr("disabled",!c);break;case "displayed":a.css("display",c?"block":"none");break;case "hidden":a.css("display",c?"none":
"block");break;default:a.attr(b,c)}};c._splitBindingAttr=function(a){var c=[],a=a.attr("data-bind").split(";");b.each(a,function(a){a=e.trim(a).split(" ");a.length==1&&a.unshift("text");c.push({elementAttr:a[0],modelAttr:a[1]})});return c};c.bind=function(a,d,e){d.$(a).each(function(){var a=d.$(this),f=c._splitBindingAttr(a);b.each(f,function(b){e.bind("change:"+b.modelAttr,c._modelChange,{element:a,elementAttr:b.elementAttr});c._setOnElement(a,b.elementAttr,e.get(b.modelAttr))})})};c.unbind=function(a,
d,e){d.$(a).each(function(){var a=d.$(this),a=c._splitBindingAttr(a);b.each(a,function(a){e.unbind("change:"+a.modelAttr,c._modelChange)})})};return c}(Backbone,_,$);
Backbone.ModelBinding.Conventions={text:{selector:"input:text",handler:Backbone.ModelBinding.StandardBinding},textarea:{selector:"textarea",handler:Backbone.ModelBinding.StandardBinding},password:{selector:"input:password",handler:Backbone.ModelBinding.StandardBinding},radio:{selector:"input:radio",handler:Backbone.ModelBinding.RadioGroupBinding},checkbox:{selector:"input:checkbox",handler:Backbone.ModelBinding.CheckboxBinding},select:{selector:"select",handler:Backbone.ModelBinding.SelectBoxBinding},
databind:{selector:"*[data-bind]",handler:Backbone.ModelBinding.DataBindBinding}};
